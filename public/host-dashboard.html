<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Dashboard - StayHub</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1><a href="index.html">StayHub</a></h1>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="host-dashboard.html" class="active">Host Dashboard</a></li>
                <li><a href="bookings.html">Bookings</a></li>
                <li><a href="#" id="logoutBtn">Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard-page">
            <h1>Host Dashboard</h1>
            
            <div class="dashboard-actions">
                <button onclick="showAddPropertyForm()" class="btn-primary">Add New Property</button>
            </div>

            <div id="addPropertyForm" class="form-card" style="display: none;">
                <h2>Add New Property</h2>
                <form id="propertyForm">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="title" required>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <input type="text" id="address" required>
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" id="city" required>
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <input type="text" id="state">
                    </div>
                    <div class="form-group">
                        <label>Price per Night (৳)</label>
                        <input type="number" id="price_per_night" required min="0">
                    </div>
                    <div class="form-group">
                        <label>Bedrooms</label>
                        <input type="number" id="bedrooms" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label>Bathrooms</label>
                        <input type="number" id="bathrooms" value="1" min="1">
                    </div>
                    <div class="form-group">
                        <label>Max Guests</label>
                        <input type="number" id="max_guests" value="2" min="1">
                    </div>
                    <div class="form-group">
                        <label>Property Type</label>
                        <select id="property_type">
                            <option value="apartment">Apartment</option>
                            <option value="house">House</option>
                            <option value="villa">Villa</option>
                            <option value="room">Room</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Amenities (comma-separated)</label>
                        <input type="text" id="amenities" placeholder="WiFi, AC, Parking, etc.">
                    </div>
                    <div class="form-group">
                        <label>House Rules</label>
                        <textarea id="house_rules"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Image URLs (comma-separated)</label>
                        <input type="text" id="images" placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg">
                    </div>
                    <button type="submit" class="btn-primary">Add Property</button>
                    <button type="button" onclick="hideAddPropertyForm()" class="btn-secondary">Cancel</button>
                </form>
            </div>

            <h2>My Properties</h2>
            <div id="myProperties">
                <!-- Properties will be loaded here -->
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script>
        function showAddPropertyForm() {
            document.getElementById('addPropertyForm').style.display = 'block';
        }

        function hideAddPropertyForm() {
            document.getElementById('addPropertyForm').style.display = 'none';
            document.getElementById('propertyForm').reset();
        }

        async function loadMyProperties() {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch('/api/properties/host/my-properties', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const properties = await response.json();
                    displayProperties(properties);
                } else {
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Error loading properties:', error);
            }
        }

        function displayProperties(properties) {
            const div = document.getElementById('myProperties');
            if (properties.length === 0) {
                div.innerHTML = '<p>No properties listed yet.</p>';
                return;
            }

            div.innerHTML = properties.map(prop => `
                <div class="property-card">
                    <img src="${prop.images && prop.images[0] ? prop.images[0] : 'https://via.placeholder.com/300x200'}" alt="${prop.title}">
                    <div class="property-info">
                        <h3>${prop.title}</h3>
                        <p>${prop.city}</p>
                        <p>৳${prop.price_per_night}/night</p>
                        <p>Status: ${prop.is_available ? 'Available' : 'Not Available'}</p>
                        <button onclick="editProperty(${prop.id})" class="btn-primary">Edit</button>
                        <button onclick="deleteProperty(${prop.id})" class="btn-secondary">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        document.getElementById('propertyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = localStorage.getItem('token');

            const amenities = document.getElementById('amenities').value
                .split(',')
                .map(a => a.trim())
                .filter(a => a);

            const images = document.getElementById('images').value
                .split(',')
                .map(i => i.trim())
                .filter(i => i);

            const formData = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                price_per_night: parseFloat(document.getElementById('price_per_night').value),
                bedrooms: parseInt(document.getElementById('bedrooms').value),
                bathrooms: parseInt(document.getElementById('bathrooms').value),
                max_guests: parseInt(document.getElementById('max_guests').value),
                property_type: document.getElementById('property_type').value,
                amenities: amenities,
                house_rules: document.getElementById('house_rules').value,
                images: images
            };

            try {
                const response = await fetch('/api/properties', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                if (response.ok) {
                    alert('Property added successfully!');
                    hideAddPropertyForm();
                    loadMyProperties();
                } else {
                    alert(data.error || 'Failed to add property');
                }
            } catch (error) {
                alert('Network error. Please try again.');
            }
        });

        async function deleteProperty(propertyId) {
            if (!confirm('Are you sure you want to delete this property?')) return;

            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`/api/properties/${propertyId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    alert('Property deleted successfully');
                    loadMyProperties();
                } else {
                    const data = await response.json();
                    alert(data.error || 'Failed to delete property');
                }
            } catch (error) {
                alert('Network error. Please try again.');
            }
        }

        function editProperty(propertyId) {
            alert('Edit functionality - to be implemented. Property ID: ' + propertyId);
        }

        loadMyProperties();
    </script>
</body>
</html>

